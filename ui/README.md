# Tapu Simu Testing UI

A comprehensive web-based testing interface for the tapu-simu Pokemon battle simulator engine.

## Features

### üèóÔ∏è Battle State Builder
- **Easy Pokemon Creation**: Auto-populated defaults from PS data when available
- **Species Selection**: Choose from available Pokemon species
- **Quick Add Buttons**: Fast Pokemon addition with preset suggestions  
- **Preset Teams**: Load pre-configured basic and competitive teams
- **Team Management**: Add/remove Pokemon with visual feedback

### ‚öîÔ∏è Move Selection Interface
- **Format-Aware Targeting**: Automatic target resolution based on move types
- **Move Selection**: Choose from each Pokemon's available moves
- **Priority Preview**: See move priorities and categories
- **Real-time Validation**: Invalid moves are highlighted

### üìä Instruction Visualization
- **Diff-Style Display**: See generated instructions in a clear format
- **Probability Branches**: View critical hit and accuracy variations
- **Affected Positions**: Highlighted positions impacted by each instruction
- **Step-by-Step Execution**: Detailed instruction breakdown

### üéÆ Real-time Engine Integration
- **Direct API Calls**: All results generated by the actual tapu-simu engine
- **State Management**: Battle state updates in real-time
- **Error Handling**: Graceful handling of engine errors
- **Format Support**: Singles, Doubles, VGC formats supported

## Architecture

### Backend (Rust)
- **Web Server**: Axum-based REST API with WebSocket support
- **Engine Bridge**: Direct integration with tapu-simu engine
- **Pokemon Builder**: Automated Pokemon creation from PS data
- **Session Management**: Battle session tracking and state management

### Frontend (React + TypeScript)
- **Component-Based**: Modular React components for each feature
- **TypeScript**: Full type safety with engine API types
- **Modern UI**: Clean, responsive design with Tailwind-inspired styles
- **Real-time Updates**: Live battle state synchronization

## Quick Start

1. **Start the Backend**:
   ```bash
   cargo run --bin ui-server --port 3001
   ```

2. **Install Frontend Dependencies** (if using full React setup):
   ```bash
   cd ui && npm install
   ```

3. **Access the Interface**:
   - **Simple HTML**: Open http://localhost:3001
   - **React Dev**: Run `npm run dev` in ui/ folder, then open http://localhost:3000

## API Endpoints

### Pokemon Management
- `GET /api/pokemon` - List all available Pokemon species
- `POST /api/pokemon/create` - Create a Pokemon with default stats
- `GET /api/pokemon/{species}` - Get Pokemon details
- `GET /api/pokemon/{species}/moves` - Get available moves for species
- `GET /api/presets/pokemon` - Get suggested Pokemon list
- `GET /api/presets/teams/{name}` - Load preset teams

### Battle Management  
- `POST /api/battles` - Create a new battle session
- `GET /api/battles/{id}` - Get battle session details
- `POST /api/battles/{id}/instructions` - Generate move instructions
- `GET /api/battles/{id}/state` - Get current battle state

### Data Endpoints
- `GET /api/moves` - List all available moves
- `GET /api/moves/{name}` - Get move details
- `GET /api/items` - List all available items

## Example Usage

### Creating a Battle

```typescript
const battleResponse = await fetch('/api/battles', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    format: {
      name: 'Singles',
      format_type: 'Singles',
      generation: 'Gen9',
      active_pokemon_count: 1,
    },
    side_one: { pokemon: [...], active_pokemon_indices: [0] },
    side_two: { pokemon: [...], active_pokemon_indices: [0] },
  })
})
```

### Generating Instructions

```typescript
const instructionsResponse = await fetch(`/api/battles/${sessionId}/instructions`, {
  method: 'POST', 
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    side_one_choice: {
      choice_type: 'move',
      move_index: 0,
      target_positions: [{ side: 'two', slot: 0 }]
    },
    side_two_choice: {
      choice_type: 'move', 
      move_index: 0,
      target_positions: [{ side: 'one', slot: 0 }]
    }
  })
})
```

## Development Notes

- **Engine Integration**: All battle logic runs through the actual tapu-simu engine
- **No Mock Data**: Instructions are generated by real battle mechanics
- **Format Awareness**: Supports all tapu-simu battle formats
- **Extensible**: Easy to add new features and visualizations
- **Type Safe**: Full TypeScript integration with Rust backend types

## Testing Scenarios

The UI supports testing various scenarios:

1. **Basic Battles**: Simple Pokemon vs Pokemon with basic moves
2. **Status Effects**: Moves that apply status conditions and stat changes
3. **Weather/Terrain**: Field condition changes and their effects
4. **Multi-Target**: Doubles battles with spread moves and redirection
5. **Critical Hits**: Probability branches for damage variations
6. **Complex Interactions**: Ability, item, and type interactions

This provides a comprehensive testing environment for validating tapu-simu's battle mechanics across all supported formats.